{% extends "base.html" %}

{% block title %}Visão Geral de Tarefas{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='tasks.css') }}">
{% endblock %}

{% block content_area_class %}content-area content-area-mural{% endblock %}
{% block content_wrapper_class %}content-wrapper content-wrapper-mural{% endblock %}

{% block sidebar_nav %}
{% include 'sidebar_home.html' %}
{% endblock %}

{% block content %}
<div class="mural-page">
  <section class="mural-board">
    <div class="mural-board-header">
      <h2><i class="bi bi-kanban"></i>Visão Geral de Tarefas</h2>
      <div>
        {% if current_user.role == 'admin' %}
        <a href="{{ url_for('tasks_new') }}" class="mural-button-new">Nova Tarefa</a>
        {% endif %}
        <a href="{{ url_for('tasks_history') }}" class="mural-button-history">Histórico{% if history_count %} ({{ history_count }}){% endif %}</a>
      </div>
    </div>
    {% from "tasks_macros.html" import render_task with context %}
    {% set status_meta = {
      'pending': {'label': 'Pendente', 'icon': 'bi-hourglass'},
      'in_progress': {'label': 'Em andamento', 'icon': 'bi-play-circle'},
      'done': {'label': 'Concluída', 'icon': 'bi-check-circle'}
    } %}
    <div class="mural-columns">
      {% for status in TaskStatus %}
      <div class="mural-column">
        <h3><i class="bi {{ status_meta[status.value].icon }}"></i>{{ status_meta[status.value].label }}</h3>
        <ul class="mural-column-list" data-status="{{ status.value }}">
          {% for task in tasks_by_status[status] %}
            {{ render_task(task, TaskStatus, show_tag=True) }}
          {% else %}
            <li class="mural-empty">Nenhuma tarefa.</li>
          {% endfor %}
        </ul>
      </div>
      {% endfor %}
    </div>
  </section>
</div>
<script>
  const csrfToken = "{{ csrf_token() }}";
</script>
<script src="{{ url_for('static', filename='javascript/tasks.js') }}"></script>
{% endblock %}
