{% extends "base.html" %}

{% block title %}Histórico de Tarefas{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='tasks.css') }}">
{% endblock %}

{% block sidebar_nav %}
{% include 'sidebar_home.html' %}
{% endblock %}

{% block content %}
<section class="kanban" data-current-user="{{ current_user.id }}">
  <div class="history-header">
    <h2><i class="bi bi-archive"></i>Histórico{% if tag %} - {{ tag.nome }}{% endif %}</h2>
    <div>
      {% if tag %}
      <a href="{{ url_for('tasks_sector', tag_id=tag.id, assigned_to_me=1 if assigned_to_me else None) }}" class="btn-history">Voltar</a>
      {% elif only_me %}
      <a href="{{ url_for('tasks_overview_personal') }}" class="btn-history">Voltar</a>
      {% else %}
      <a href="{{ url_for('tasks_overview', assigned_by_me=1 if assigned_by_me else None) }}" class="btn-history">Voltar</a>
      {% endif %}
    </div>
  </div>
  <ul class="history-list">
    {% for task in tasks if not task.is_private or task.created_by == current_user.id %}
    {% set tag_label = 'Para Mim' if task.is_private and task.created_by == current_user.id else task.tag.nome %}
    <li class="history-item">
      <span class="title">{{ task.title }}</span>
      <span class="meta">{{ tag_label }}{% if task.completed_at %} - {{ task.completed_at.strftime('%d/%m/%Y') }}{% endif %}</span>
      <a href="{{ url_for('tasks_view', task_id=task.id) }}" class="btn-view">Visualizar</a>
    </li>
    {% else %}
    <li class="empty">Nenhuma tarefa.</li>
    {% endfor %}
  </ul>
  
{% include "tasks_responses_panel.html" %}
</section>
{% endblock %}

