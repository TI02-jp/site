{% extends "base.html" %}

{% block title %}Relatório de Usuários{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Usuários por Tipo e Status</h1>
    <div id="chart-container">
        {{ chart_div|safe }}
    </div>
    <div id="user-list" class="mt-4 d-flex justify-content-center"></div>
</div>
<script>
    const usersBySlice = {{ users_by_slice|tojson }};
    const chart = document.getElementById('user-role-chart');
    if (chart) {
        chart.on('plotly_click', function(data){
            const label = data.points[0].label;
            const users = usersBySlice[label] || [];
            const container = document.getElementById('user-list');
            if (!users.length) {
                container.innerHTML = '<p class="text-center">Nenhum usuário encontrado.</p>';
                return;
            }
            let html = '<div class="table-responsive"><table class="table table-striped w-auto text-start"><thead><tr><th>Nome</th><th>Email</th><th>Usuário</th></tr></thead><tbody>';
            users.forEach(u => {
                const name = u.name ? u.name.toUpperCase() : '';
                const email = u.email ? u.email.toLowerCase() : '';
                const username = u.username ? u.username.toLowerCase() : '';
                html += `<tr><td>${name}</td><td>${email}</td><td>${username}</td></tr>`;
            });
            html += '</tbody></table></div>';
            container.innerHTML = html;
        });
    }
</script>
{% endblock %}
