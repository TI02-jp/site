{% extends "base.html" %}

{% block title %}Sala de Reuniões{% endblock %}

{% block sidebar_nav %}
<div class="nav-section">
    <div class="nav-section-title">PRINCIPAL</div>
    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('dashboard') }}">
                <i class="bi bi-list-task"></i>
                PARTICULARIDADES
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="https://app.acessorias.com/sysmain.php" target="_blank" rel="noopener">
                <i class="bi bi-box-arrow-up-right"></i>
                ACESSÓRIAS
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="https://auth.sieg.com/login" target="_blank" rel="noopener">
                <i class="bi bi-box-arrow-up-right"></i>
                SIEG
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('consultorias') }}">
                <i class="bi bi-buildings"></i>
                CONSULTORIAS
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link active" href="{{ url_for('sala_reunioes') }}">
                <i class="bi bi-calendar-event"></i>
                SALA DE REUNIÕES
            </a>
        </li>
    </ul>
</div>
<style>
    .content-breadcrumb { display: none; }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <h1 class="mb-4"><i class="bi bi-calendar-event me-2"></i>Agenda da Sala de Reuniões</h1>
    {% if current_user.role == 'admin' %}
    <a href="{{ url_for('criar_evento') }}" class="btn btn-primary mb-3"><i class="bi bi-plus-circle"></i> Criar Evento</a>
    {% endif %}
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Período</th>
                    <th>Evento</th>
                    <th>Usuário</th>
                </tr>
            </thead>
            <tbody>
                {% for event in events %}
                <tr data-end="{{ event.end_iso }}">
                    <td>{{ event.date }}</td>
                    <td>{{ event.start }} - {{ event.end }}</td>
                    <td>{{ event.title }}</td>
                    <td>{{ event.user }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="4" class="text-center">Nenhum evento cadastrado</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const rows = document.querySelectorAll('tbody tr[data-end]');
    const now = new Date();
    rows.forEach(row => {
        const end = new Date(row.dataset.end);
        const diff = end.getTime() + 5 * 60 * 1000 - now.getTime();
        if (diff <= 0) {
            row.style.display = 'none';
        } else {
            setTimeout(() => {
                row.style.display = 'none';
            }, diff);
        }
    });
});
</script>
{% endblock %}
