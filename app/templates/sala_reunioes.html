{% extends "base.html" %}

{% block title %}SALA DE REUNIÕES{% endblock %}

{% block sidebar_nav %}
<div class="nav-section">
    <div class="nav-section-title">PRINCIPAL</div>
    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('dashboard') }}">
                <i class="bi bi-list-task"></i>
                PARTICULARIDADES
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="https://app.acessorias.com/sysmain.php" target="_blank" rel="noopener">
                <i class="bi bi-box-arrow-up-right"></i>
                ACESSÓRIAS
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="https://auth.sieg.com/login" target="_blank" rel="noopener">
                <i class="bi bi-box-arrow-up-right"></i>
                SIEG
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('consultorias') }}">
                <i class="bi bi-buildings"></i>
                CONSULTORIAS
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link active" href="{{ url_for('sala_reunioes') }}">
                <i class="bi bi-calendar-event"></i>
                SALA DE REUNIÕES
            </a>
        </li>
    </ul>
</div>
<style>
    .content-breadcrumb { display: none; }
</style>
{% endblock %}

{% block content %}
<header class="py-5 text-white text-center" style="background-color: var(--primary);">
    <h1 class="display-4 mb-0"><i class="bi bi-calendar-event me-3"></i>AGENDA DA SALA DE REUNIÕES</h1>
</header>
<div class="container my-4">
    <p class="text-muted">Aqui você poderá consultar a agenda da sala de reuniões.</p>
    {% if current_user.role == 'admin' %}
    <div class="text-end mb-3">
        <a href="{{ url_for('novo_evento') }}" class="btn btn-primary">Criar Evento</a>
    </div>
    {% endif %}
    <table class="table table-bordered text-center" id="calendar">
        <thead>
            <tr>
                <th>Seg</th>
                <th>Ter</th>
                <th>Qua</th>
                <th>Qui</th>
                <th>Sex</th>
                <th>Sáb</th>
                <th>Dom</th>
            </tr>
        </thead>
        <tbody>
            {% for week in weeks %}
            <tr>
                {% for day in week %}
                {% set iso = day.isoformat() %}
                <td class="py-3{% if day.month != today.month %} text-muted{% endif %}{% if iso in events_by_date %} bg-primary text-white has-event{% endif %}"
                    data-date="{{ iso }}">{{ day.day }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div id="event-list" class="mt-4"></div>
</div>
<script>
const events = {{ events_by_date|tojson }};
document.querySelectorAll('#calendar td.has-event').forEach(td => {
    td.addEventListener('click', () => {
        const iso = td.dataset.date;
        const list = events[iso] || [];
        let html = `<h4>Eventos em ${new Date(iso).toLocaleDateString()}</h4>`;
        if (list.length === 0) {
            html += '<p>Nenhum evento.</p>';
        } else {
            html += '<ul>';
            list.forEach(ev => {
                html += `<li><strong>${ev.inicio} - ${ev.fim}</strong> ${ev.evento} (${ev.usuario})</li>`;
            });
            html += '</ul>';
        }
        document.getElementById('event-list').innerHTML = html;
    });
});
</script>
{% endblock %}

