{% macro render_task(task, TaskStatus, show_tag=False) %}
<li class="list-group-item">
    <div class="d-flex justify-content-between align-items-start">
        <div class="flex-grow-1">
            <strong>{{ task.title }}</strong>
            {% if show_tag %}
            <span class="badge bg-secondary">{{ task.tag.nome }}</span>
            {% endif %}
            {% if task.due_date %}
            <small class="text-muted d-block">Prazo: {{ task.due_date.strftime('%d/%m/%Y') }}</small>
            {% endif %}
            {% if task.children %}
            <div class="progress mt-1" style="height: 4px;">
                <div class="progress-bar" style="width: {{ task.progress }}%;"></div>
            </div>
            {% endif %}
            {% if task.status == TaskStatus.IN_PROGRESS and task.assignee %}
            <small class="text-muted d-block">Em andamento por: {{ task.assignee.name }}</small>
            {% elif task.status == TaskStatus.DONE and task.finisher %}
            <small class="text-muted d-block">Finalizado por: {{ task.finisher.name }}</small>
            {% elif task.assignee %}
            <small class="text-muted d-block">Respons√°vel: {{ task.assignee.name }}</small>
            {% endif %}
        </div>
        <div class="btn-group btn-group-sm ms-2">
            {% if task.status == TaskStatus.PENDING %}
            <button
                class="btn btn-outline-primary change-status"
                data-id="{{ task.id }}"
                data-status="in_progress"
                title="Iniciar"
            ><i class="bi bi-play"></i></button>
            <button
                class="btn btn-outline-warning change-status"
                data-id="{{ task.id }}"
                data-status="blocked"
                title="Bloquear"
            ><i class="bi bi-slash-circle"></i></button>
            {% elif task.status == TaskStatus.IN_PROGRESS %}
            <button
                class="btn btn-outline-success change-status"
                data-id="{{ task.id }}"
                data-status="done"
                title="Concluir"
            ><i class="bi bi-check-lg"></i></button>
            <button
                class="btn btn-outline-warning change-status"
                data-id="{{ task.id }}"
                data-status="blocked"
                title="Bloquear"
            ><i class="bi bi-slash-circle"></i></button>
            {% elif task.status == TaskStatus.BLOCKED %}
            <button
                class="btn btn-outline-primary change-status"
                data-id="{{ task.id }}"
                data-status="in_progress"
                title="Retomar"
            ><i class="bi bi-play"></i></button>
            {% elif task.status == TaskStatus.DONE and current_user.role == 'admin' %}
            <button
                class="btn btn-outline-secondary change-status"
                data-id="{{ task.id }}"
                data-status="in_progress"
                title="Reabrir"
            ><i class="bi bi-arrow-counterclockwise"></i></button>
            {% endif %}
            <a
                class="btn btn-outline-secondary"
                href="{{ url_for('tasks_new', parent_id=task.id) }}"
                title="Subtarefa"
            ><i class="bi bi-plus-lg"></i></a>
        </div>
    </div>
    {% if task.children %}
    <ul class="list-group mt-2">
        {% for child in task.children %}
            {{ render_task(child, TaskStatus, show_tag=show_tag) }}
        {% endfor %}
    </ul>
    {% endif %}
</li>
{% endmacro %}
