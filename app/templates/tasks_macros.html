{% macro render_task(task, TaskStatus, show_tag=False) %}
<li class="task-card">
  <div class="task-header">
    <div class="task-info">
      <span class="task-title">{{ task.title }}</span>
      {% if show_tag %}
      <span class="task-tag">{{ task.tag.nome }}</span>
      {% endif %}
      {% if task.due_date %}
      <div class="task-meta">Prazo: {{ task.due_date.strftime('%d/%m/%Y') }}</div>
      {% endif %}
      {% if task.children %}
      <div class="progress"><div style="width: {{ task.progress }}%;"></div></div>
      {% endif %}
      {% if task.status == TaskStatus.IN_PROGRESS and task.assignee %}
      <div class="task-meta">Em andamento por: {{ task.assignee.name }}</div>
      {% elif task.status == TaskStatus.DONE and task.finisher %}
      <div class="task-meta">Finalizado por: {{ task.finisher.name }}</div>
      {% elif task.assignee %}
      <div class="task-meta">Respons√°vel: {{ task.assignee.name }}</div>
      {% endif %}
    </div>
    <div class="task-actions">
      {% if task.status == TaskStatus.PENDING %}
      <button class="action change-status" data-id="{{ task.id }}" data-status="in_progress" title="Iniciar"><i class="bi bi-play"></i></button>
      <button class="action change-status" data-id="{{ task.id }}" data-status="blocked" title="Bloquear"><i class="bi bi-slash-circle"></i></button>
      {% elif task.status == TaskStatus.IN_PROGRESS %}
      <button class="action change-status" data-id="{{ task.id }}" data-status="done" title="Concluir"><i class="bi bi-check-lg"></i></button>
      <button class="action change-status" data-id="{{ task.id }}" data-status="blocked" title="Bloquear"><i class="bi bi-slash-circle"></i></button>
      {% elif task.status == TaskStatus.BLOCKED %}
      <button class="action change-status" data-id="{{ task.id }}" data-status="in_progress" title="Retomar"><i class="bi bi-play"></i></button>
      {% elif task.status == TaskStatus.DONE and current_user.role == 'admin' %}
      <button class="action change-status" data-id="{{ task.id }}" data-status="in_progress" title="Reabrir"><i class="bi bi-arrow-counterclockwise"></i></button>
      {% endif %}
      {% if current_user.role == 'admin' %}
      <a class="action subtask" href="{{ url_for('tasks_new', parent_id=task.id) }}" title="Subtarefa"><i class="bi bi-plus-lg"></i></a>
      {% endif %}
    </div>
  </div>
  {% if task.children %}
  <ul class="subtasks">
    {% for child in task.children %}
      {{ render_task(child, TaskStatus, show_tag=show_tag) }}
    {% endfor %}
  </ul>
  {% endif %}
</li>
{% endmacro %}
