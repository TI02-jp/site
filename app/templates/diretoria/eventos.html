{% extends "base.html" %}
{% block title %}Eventos - Diretoria JP{% endblock %}

{% block sidebar_nav %}
    {% include 'sidebar_home.html' %}
{% endblock %}

{% block content %}
<div class="container py-3">
    <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-2 mb-3">
        <div>
            <h1 class="h4 mb-1">Eventos Registrados</h1>
            <p class="text-muted mb-0">Consulte todos os detalhes informados para treinamentos, datas comemorativas e demais eventos.</p>
        </div>
        <a class="btn btn-primary btn-sm align-self-lg-start" href="{{ url_for('diretoria_eventos_novo') }}">
            <i class="bi bi-plus-lg me-2"></i>Registrar evento
        </a>
    </div>

    {% if events %}
    {% set type_labels = {
        'treinamento': 'Treinamento',
        'data_comemorativa': 'Data Comemorativa',
        'evento': 'Evento'
    } %}
    <div class="card shadow-sm">
        <div class="card-body p-0">
            <div class="table-responsive-lg">
                <table class="table table-striped table-hover table-sm align-top mb-0 small">
                    <thead class="table-light">
                        <tr>
                            <th scope="col">Tipo</th>
                            <th scope="col">Data</th>
                            <th scope="col" style="min-width: 220px;">Descrição</th>
                            <th scope="col">Interno</th>
                            <th scope="col">Externo</th>
                            <th scope="col">Participantes</th>
                            <th scope="col">Café da manhã</th>
                            <th scope="col">Almoço</th>
                            <th scope="col">Lanche</th>
                            <th scope="col" style="min-width: 220px;">Outros Materiais</th>
                            <th scope="col">Registrado por</th>
                            <th scope="col">Criado em</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for event in events %}
                        <tr>
                            <td class="text-uppercase fw-semibold">{{ type_labels.get(event.event_type, event.event_type|capitalize) }}</td>
                            <td>{{ event.event_date.strftime('%d/%m/%Y') }}</td>
                            <td class="text-break">{{ event.description or '—' }}</td>
                            <td>{{ 'Sim' if event.attendees_internal else 'Não' }}</td>
                            <td>{{ 'Sim' if event.attendees_external else 'Não' }}</td>
                            <td>{{ event.participants_count or 0 }}</td>
                            <td>
                                {% if event.include_breakfast %}
                                    R$ {{ '%.2f'|format(event.cost_breakfast or 0) }}
                                {% else %}
                                    Não
                                {% endif %}
                            </td>
                            <td>
                                {% if event.include_lunch %}
                                    R$ {{ '%.2f'|format(event.cost_lunch or 0) }}
                                {% else %}
                                    Não
                                {% endif %}
                            </td>
                            <td>
                                {% if event.include_snack %}
                                    R$ {{ '%.2f'|format(event.cost_snack or 0) }}
                                {% else %}
                                    Não
                                {% endif %}
                            </td>
                            <td class="text-break">
                                {% set materials = event.other_materials or [] %}
                                {% if materials %}
                                    {% for material in materials %}
                                        <div>
                                            {{ (material.description or 'Sem descrição') if material.description is defined else 'Sem descrição' }}
                                            {% if material.value is not none %}
                                                - R$ {{ '%.2f'|format(material.value) }}
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                {% else %}
                                    —
                                {% endif %}
                            </td>
                            <td>{{ event.created_by.name if event.created_by else '—' }}</td>
                            <td>{{ event.created_at.strftime('%d/%m/%Y %H:%M') if event.created_at else '—' }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% else %}
    <div class="card shadow-sm">
        <div class="card-body text-center py-5 text-muted">
            <i class="bi bi-calendar-x fs-1 d-block mb-3"></i>
            Nenhum evento cadastrado até o momento.
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
